# Терминалы PSXCPU

:warning: Привести раздел в порядок, сделать разделы более понятным, возможно лучше в виде большой таблицы. Пометить In/Out.

У процессора очень много терминалов - 208. Это обусловлено большим количеством шин.

Внутри их становится ещё больше, потому что VDD/VSS с одного вывода приходят сразу на 2 спаренных контактных площадки.

Питание и земля огибает процессор по краям, а также пересекает его крест-на-крест, поэтому центральную область мы называем "перекрестием".

Чуть правее перекрестия находится вертикальная дистрибуция Main CLK по всему чипу.

![IC103_contacts](/imgstore/pads/IC103_contacts.jpg)

![PSXCPU_pads_service_manual](/imgstore/pads/PSXCPU_pads_service_manual.jpg)

## Тайминг и сброс CPU

- CRYSTALP: входной CLK, 67.73 MHz
- SYSCLK0: CLK на вход GPU (33.3 MHz)
- SYSCLK1: CLK на девайсы Sub bus (33.3 MHz)
- DSYSCLK: CLK \* 2 на вход GPU (66.67 MHz NTSC, 64.5 MHz PAL)
- /EXT RESET: сброс (приходит с общего сигнала RES3.3 от блока питания)

![CPU_clk](/imgstore/pads/CPU_clk.jpg)

## PIO

- /CS0: Выбрать PIO на Sub bus. Одновременно на шину может быть подключен только один девайс, во избежание конфликта шин. Этим управляют контакты группы "CS" (chip select).
- DACK5 / DREQ5: PIO DMA
- /INTIN10: контакт совмещен с контроллерами/картами памяти и PIO (общий сигнал прерывания).

## SIO

- RXD1, TXD1, /DSR1, /DTR1, /CTS1, /RTS1: классический последовательный интерфейс

## Контроллеры/карты памяти

Представляют собой вариацию SIO.

- /SCK0: тайминг для контроллеров (строб?)
- RXD0, TXD0, /DSR0, /DTR0A, /DTR0B: последовательный интерфейс. DTR имеет два контакта, поскольку у нас два порта для контроллеров/карт памяти (Port A и Port B)

![Front_jack](/imgstore/pads/Front_jack.jpg)

## DRAM

В более новых материнках оперативная память представляет собой один чип (IC106), но раньше их было больше (4). Мы будем ориентироваться на более новый вариант, потому что это удобно.

- DD: 32-разрядная DRAM Data bus. Предназначена для передачи данных между CPU и DRAM.
- DA: 13-разрядная DRAM Address bus. Процессор выставляет адрес, для доступа к DRAM.
- /DWE: write enable
- /DRAS0, /DCAS0, /DCAS1, /DCAS2, /DCAS3: рефреш

![DA0_routing](/imgstore/pads/DA0_routing.jpg)

## ROM BIOS + Sub Bus

ROM подсоединен к Sub bus.

- /CS2: Подключить ROM к шине Sub bus. Непосредственно обмен данным (OE) включается, если активен сигнал read enable (/SRD). Ну это понятно, ROM можно только читать :)
- /SWR0, /SWR1: Sub bus write enable. SWR0 предназначен как для внутренних девайсов Sub bus, так и для PIO, а вот SWR1 подается почему-то эксклюзивно только на PIO.
- /SRD: Sub bus read enable.

## Интерфейс GPU

- VD: шина данных 32-бит, подключена к Main bus
- VA2: адресная шина, 1-бит :) Дело в том, что у GPU всего-лишь два 32-разрядных регистра (GP0/GP1), поэтому для их адресации достаточно одной адресной линии.
- /VRD, /VWR: read/write enable
- /CS7: Выбрать GPU
- DREQ2, DACK2: GPU DMA. Когда для передачи данных используется контроллер прямого доступа к памяти, графический 
процессор посылает сигнал запроса на захват шины, устанавливая низкий логический уровень на контакте GPUDREQ. Получив такой запрос, процессор освобождает шины, извещая об этом установкой низкого логического уровня на выходе GPUDACK.
- /INTIN0: сигнал прерывания GPU VBLANK
- TCLK0: выходит с контакта GPU PCK (pixel clock), может использоваться в качестве Root Counter 0 (счетчик точек)
- TCLK1: выходит с контакта GPU HBLANK, может использоваться в качестве Root Counter 1 (счетчик горизонтальных линий)
- /INTIN1: общее прерывание GPU (может быть вызвано отправкой специальной команды в GPU, но насколько мне известно в играх не используется)

## Интерфейс CD-ROM

- /CS5: выбрать CD-контроллер
- /INTIN2: прерывание от CD-контроллера

## Интерфейс SPU

- /CS4: выбрать SPU
- /INTIN9: прерывание от SPU
- DACK4, /DREQ4: SPU DMA

## Схемы терминалов

Ниже рассмотрена схемотехника всех вариантов терминалов.

:warning: Привести раздел в порядок, отвязать терминал от названий (DD/DA), собрать всю топологию всех вариантов терминалов.

### Терминал Output

На контакт поступает 1 провод (собственно разряд адреса).

Контакт устроен просто. Вначале DA подается на цепочку push-pull инверторов, для предварительного усиления:

![DA1](/imgstore/pads/DA1.jpg)

Затем значение в инвертированной форме подается на мощный инвертор, который выходит сразу на контакт.

![DA2](/imgstore/pads/DA2.jpg)

На картинке представлена только одна половина "гребенки" инвертора, вторая часть не попала в слайды, которые делал декапер. Примерное устройство инвертора такое-же как у контакта шины DD, за исключением того, что нет входного провода и ESD.

### Терминал Inout + TriState

Внутренне контакты шины DD имеют разводку на 6 шлангов:

![DD_pad](/imgstore/pads/DD_pad.jpg)

- WR=1, когда цикл записи (CPU выдает данные наружу)
- RD=1, когда цикл чтения (CPU получает данные снаружи). Я не совсем уверен что это RD, это может быть например и сигнал сброса RES=1 и ещё что-нибудь ещё, что не даёт шине работать наружу. Так или иначе, но шина работает наружу только при комбинации ab = 10.
- CPU/DD(n): данные для выдачи на шину данных
- DD(n)/CPU: данные для чтения
- e/f: назначение пока не понятно. Эти линии соединяют контакты по-очереди (F приходит с предыдущего контакта, а E уходит на вход F следующего). Самый первый F и самый последний E уходят куда-то далеко в недра CPU. Возможно какая-то грязная схема, для проверки входных данных на 0.

Замечание: в усилительной "гребенке" на выходе используются не все транзисторы, большая часть отключена. Также входной шланг соединяется с какими-то демоническими кусками диффузии с отсоединенными транзисторами, скорее всего это защита от статики (ESD). Ещё один элемент ESD - это инвертор без выхода (диод?)
